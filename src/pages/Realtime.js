import React from "react";
import mapboxgl from "mapbox-gl";
import socketIOClient from "socket.io-client";

const mapStyle = {
  position: "absolute",
  top: 50,
  right: 0,
  left: 0,
  bottom: 0
};

mapboxgl.accessToken =
  "pk.eyJ1IjoicmVuZWVsaW4iLCJhIjoiY2s2bGdsM294MGFyNDNkcGZxdjRiamVtZCJ9.NXBRh4xFGeNFfqikqH97bA";

class Realtime extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      response: {
        geometry: {
          type: "Point",
          coordinates: [153.00682100000006, -27.501533999999936]
        },
        type: "Feature",
        properties: {}
      },
      lng: 153.0137,
      lat: -27.4975,
      // lng: 36.19583044471166,
      // lat: 44.17716381518971,
      zoom: 13,
      //endpoint: "http://localhost:4000"
      endpoint: "http://146.148.69.40:4000"
    };
  }

  componentDidMount() {
    const { endpoint } = this.state;
    const socket = socketIOClient(endpoint);
    socket.on("post", data => {
      // console.log(data);
      this.setState({ response: data });
    });
    fetch(endpoint).then(data => console.log(data));
    var map = (window.map = new mapboxgl.Map({
      container: this.mapContainer,
      style: "mapbox://styles/mapbox/streets-v11",
      zoom: 12,
      center: [this.state.lng, this.state.lat],
      pitch: 60,
      antialias: true // create the gl context with MSAA antialiasing, so custom layers are antialiased
    }));
    var that = this;
    var map = (window.map = new mapboxgl.Map({
      container: this.mapContainer,
      style: "mapbox://styles/mapbox/dark-v9",
      zoom: this.state.zoom,
      // center: [this.state.lng, this.state.lat],
      center: [153.00682100000006, -27.501533999999936],
      pitch: 60,
      antialias: true // create the gl context with MSAA antialiasing, so custom layers are antialiased
    }));
    map.addControl(new mapboxgl.NavigationControl());

    // var url = "https://wanderdrone.appspot.com/";
    map.on("load", function() {
      window.setInterval(function() {
        map.getSource("drone").setData(that.state.response);
      }, 2000);

      map.addSource("route", {
        type: "geojson",
        data: {
          type: "Feature",
          properties: {},
          geometry: {
            type: "LineString",
            coordinates: [
              [153.00682100000006, -27.501533999999936, 0],
              [153.00687800000003, -27.501709999999946, 0],
              [153.00690100000008, -27.501697999999976, 0],
              [153.00691400000005, -27.50169399999993, 0],
              [153.0069390000001, -27.501691999999935, 0],
              [153.00696400000004, -27.501694999999984, 0],
              [153.00697700000012, -27.501698999999974, 0],
              [153.00699100000008, -27.50170499999996, 0],
              [153.00701400000003, -27.501721999999972, 0],
              [153.0070280000001, -27.501736999999935, 0],
              [153.00704500000006, -27.501764999999978, 0],
              [153.00723000000005, -27.501665999999943, 0],
              [153.00819, -27.500941999999952, 0],
              [153.00929200000007, -27.50010199999997, 0],
              [153.01070400000003, -27.499021999999968, 0],
              [153.01069700000005, -27.49901399999993, 0],
              [153.0106820000001, -27.498986999999943, 0],
              [153.0106720000001, -27.49894699999993, 0],
              [153.0106720000001, -27.498922999999934, 0],
              [153.0106770000001, -27.498892999999953, 0],
              [153.01068900000007, -27.49886299999997, 0],
              [153.01069700000005, -27.498851999999943, 0],
              [153.01070400000003, -27.49884099999997, 0],
              [153.01073000000008, -27.49881799999997, 0],
              [153.01075300000002, -27.498805999999945, 0],
              [153.0107680000001, -27.498800999999958, 0],
              [153.01077900000007, -27.498798999999963, 0],
              [153.010803, -27.498797999999965, 0],
              [153.01082700000006, -27.498802999999953, 0],
              [153.01085100000012, -27.49881399999998, 0],
              [153.01087200000006, -27.498828999999944, 0],
              [153.0109080000001, -27.498759999999947, 0],
              [153.0110770000001, -27.497969999999953, 0],
              [153.01110400000005, -27.49786899999998, 0],
              [153.0111240000001, -27.49757399999993, 0],
              [153.01122900000007, -27.497522999999944, 0],
              [153.0113500000001, -27.497570999999937, 0],
              [153.01140400000008, -27.497743999999955, 0],
              [153.0112660000001, -27.49785099999997, 0],
              [153.01111600000002, -27.49794499999996, 0],
              [153.0110770000001, -27.497969999999953, 0],
              [153.0109080000001, -27.498759999999947, 0],
              [153.01087200000006, -27.498828999999944, 0],
              [153.01087900000005, -27.498835999999983, 0],
              [153.01089400000012, -27.498855999999932, 0],
              [153.0109010000001, -27.49886799999996, 0],
              [153.01091100000008, -27.498894999999948, 0],
              [153.01091600000007, -27.49892699999998, 0],
              [153.01091600000007, -27.498940999999945, 0],
              [153.01091200000008, -27.498963999999944, 0],
              [153.0109040000001, -27.498990999999933, 0],
              [153.01089000000002, -27.499015999999983, 0],
              [153.01087900000005, -27.49902899999995, 0],
              [153.01085100000012, -27.49905099999995, 0],
              [153.01084000000003, -27.499056999999937, 0],
              [153.01082500000007, -27.49906199999998, 0],
              [153.01079700000003, -27.499066999999968, 0],
              [153.0107690000001, -27.499063999999976, 0],
              [153.01073800000006, -27.49905199999995, 0],
              [153.01071100000001, -27.499031999999943, 0],
              [153.01070400000003, -27.499021999999968, 0],
              [153.01069700000005, -27.49901399999993, 0],
              [153.0106820000001, -27.498986999999943, 0],
              [153.0106720000001, -27.49894699999993, 0],
              [153.0106720000001, -27.498922999999934, 0],
              [153.0106770000001, -27.498892999999953, 0],
              [153.01068900000007, -27.49886299999997, 0],
              [153.01069700000005, -27.498851999999943, 0],
              [153.0105820000001, -27.498809999999935, 0],
              [153.01029500000004, -27.49876299999994, 0],
              [153.01019600000006, -27.498745999999983, 0],
              [153.00988200000006, -27.498598999999956, 0],
              [153.00966900000003, -27.49846699999995, 0],
              [153.00960800000007, -27.498440999999957, 0],
              [153.0095480000001, -27.498392999999965, 0],
              [153.00940800000012, -27.498387999999977, 0],
              [153.00888200000009, -27.498472999999933, 0],
              [153.00861500000008, -27.498509999999953, 0],
              [153.00847800000008, -27.49850699999996, 0],
              [153.00817300000006, -27.49845899999997, 0],
              [153.0081060000001, -27.49846699999995, 0],
              [153.00749900000005, -27.498374999999953, 0],
              [153.00661300000002, -27.49822299999994, 0],
              [153.0066220000001, -27.49816899999996, 0],
              [153.00668600000006, -27.49771999999996, 0],
              [153.00670100000002, -27.49768599999993, 0],
              [153.00672100000008, -27.497639999999933, 0],
              [153.00679100000002, -27.497105999999974, 0],
              [153.00682300000005, -27.496628999999928, 0],
              [153.0063520000001, -27.495052999999928, 0],
              [153.00629600000002, -27.494839999999954, 0],
              [153.00624000000005, -27.49442199999993, 0],
              [153.00616200000002, -27.49384299999997, 0],
              [153.0050470000001, -27.493998999999974, 0],
              [153.0039670000001, -27.49415399999998, 0],
              [153.00330900000006, -27.494249999999965, 0],
              [153.003103, -27.494289999999978, 0],
              [153.0028890000001, -27.49433099999993, 0],
              [153.00202300000012, -27.494637999999952, 0],
              [153.00177200000007, -27.494704999999954, 0],
              [153.00159100000008, -27.494704999999954, 0],
              [153.0014000000001, -27.494682999999952, 0],
              [153.00118400000008, -27.494645999999932, 0],
              [153.0000020000001, -27.494451999999967, 0],
              [152.99983100000009, -27.494425999999976, 0],
              [152.99833300000012, -27.494190999999944, 0],
              [152.99826000000007, -27.494200999999975, 0],
              [152.99817100000007, -27.494178999999974, 0],
              [152.99809200000004, -27.494154999999978, 0],
              [152.99794700000007, -27.49408399999993, 0],
              [152.99789500000009, -27.49401299999994, 0],
              [152.99763300000006, -27.493879999999933, 0],
              [152.99674000000005, -27.493428999999935, 0],
              [152.99572200000011, -27.49288599999994, 0],
              [152.9952760000001, -27.492647999999974, 0],
              [152.99475700000005, -27.49233099999998, 0],
              [152.9946520000001, -27.49226699999997, 0],
              [152.99456600000008, -27.49225199999995, 0],
              [152.99440900000002, -27.49215899999996, 0],
              [152.99418800000012, -27.492025999999953, 0],
              [152.99413400000003, -27.49194499999993, 0],
              [152.99421700000005, -27.491813999999977, 0],
              [152.99431900000002, -27.491628999999932, 0],
              [152.9943790000001, -27.491498999999976, 0],
              [152.99439600000005, -27.49144599999994, 0],
              [152.9944170000001, -27.49129499999998, 0],
              [152.9944190000001, -27.491188999999963, 0],
              [152.99440900000002, -27.491055999999958, 0],
              [152.99430600000005, -27.490711999999974, 0],
              [152.9942470000001, -27.490602999999965, 0],
              [152.99412500000005, -27.49042799999995, 0],
              [152.99398700000006, -27.490254999999934, 0],
              [152.99391000000003, -27.490151999999966, 0],
              [152.99385900000004, -27.49007599999993, 0],
              [152.99382300000002, -27.48998199999994, 0],
              [152.99380100000008, -27.489905999999962, 0],
              [152.9937860000001, -27.489800999999943, 0],
              [152.99378300000012, -27.489724999999964, 0],
              [152.9937910000001, -27.489626999999928, 0],
              [152.99382100000003, -27.489443999999935, 0],
              [152.99386900000002, -27.489166999999952, 0],
              [152.9938830000001, -27.489035999999942, 0],
              [152.993871, -27.48892799999993, 0],
              [152.9938390000001, -27.488808999999947, 0],
              [152.99376100000006, -27.488662999999974, 0],
              [152.99346800000012, -27.48833899999994, 0],
              [152.99315300000012, -27.487993999999958, 0],
              [152.9930290000001, -27.48784699999993, 0],
              [152.99299200000007, -27.487796999999944, 0],
              [152.99296200000003, -27.487742999999966, 0],
              [152.99291400000004, -27.487635999999952, 0],
              [152.99289800000008, -27.487559999999974, 0],
              [152.9928950000001, -27.48747899999995, 0],
              [152.99290200000007, -27.487361999999962, 0],
              [152.9929780000001, -27.486877999999933, 0],
              [152.99303200000008, -27.486622999999952, 0],
              [152.99303700000007, -27.486599999999953, 0],
              [152.99310000000003, -27.486354999999946, 0],
              [152.99317200000007, -27.486125999999956, 0],
              [152.9932070000001, -27.48600399999998, 0],
              [152.99346800000012, -27.485075999999935, 0],
              [152.993557, -27.484937999999943, 0],
              [152.99377700000002, -27.484760999999935, 0],
              [152.99498800000003, -27.48381799999993, 0],
              [152.99533000000008, -27.483652999999947, 0],
              [152.99567700000011, -27.483552999999972, 0],
              [152.99589500000002, -27.483457999999928, 0],
              [152.99607400000002, -27.48329199999995, 0],
              [152.99633000000006, -27.48291699999993, 0],
              [152.99648600000012, -27.482667999999933, 0],
              [152.99660100000006, -27.48244699999998, 0],
              [152.997114, -27.48153099999996, 0],
              [152.9975270000001, -27.480906999999945, 0],
              [152.9980670000001, -27.480107999999973, 0],
              [152.99818700000003, -27.47992899999997, 0],
              [152.9984280000001, -27.47958699999998, 0],
              [152.9995060000001, -27.47849199999996, 0],
              [153.00047400000005, -27.477589999999964, 0],
              [153.00168600000006, -27.47648499999997, 0],
              [153.00300100000004, -27.475293999999963, 0],
              [153.00326800000005, -27.474995999999976, 0],
              [153.00380500000006, -27.47439799999995, 0],
              [153.00449600000002, -27.473709999999983, 0],
              [153.00493200000005, -27.47332899999998, 0],
              [153.00521700000002, -27.47311099999996, 0],
              [153.00566000000003, -27.472783999999933, 0],
              [153.00648200000012, -27.472110999999984, 0],
              [153.00841400000002, -27.47052999999994, 0],
              [153.00861200000008, -27.47037899999998, 0],
              [153.0092380000001, -27.469836999999927, 0],
              [153.0096380000001, -27.46947899999998, 0],
              [153.00988700000005, -27.469266999999945, 0],
              [153.00997000000007, -27.46919699999995, 0],
              [153.01033100000006, -27.468954999999937, 0],
              [153.01056900000003, -27.468805999999972, 0],
              [153.01076000000012, -27.46869399999997, 0],
              [153.01114900000005, -27.46849999999995, 0],
              [153.01155400000005, -27.468338999999958, 0],
              [153.01187300000004, -27.468226999999956, 0],
              [153.01235000000008, -27.468091999999956, 0],
              [153.01282300000003, -27.46794699999998, 0],
              [153.01357200000007, -27.46768899999995, 0],
              [153.01385200000004, -27.467641999999955, 0],
              [153.01385600000003, -27.46762499999994, 0],
              [153.0143640000001, -27.467472999999927, 0],
              [153.01501100000007, -27.467330999999945, 0],
              [153.01507400000003, -27.467281999999955, 0],
              [153.01511400000004, -27.467239999999947, 0],
              [153.0151380000001, -27.467199999999934, 0],
              [153.01514800000007, -27.467138999999975, 0],
              [153.01516000000004, -27.46702399999998, 0],
              [153.01503900000012, -27.46684199999993, 0],
              [153.0149090000001, -27.46665399999995, 0],
              [153.01474100000007, -27.466497999999945, 0],
              [153.01470100000006, -27.466182999999944, 0],
              [153.01503000000002, -27.46613099999996, 0],
              [153.01598200000012, -27.46597799999995, 0],
              [153.0161720000001, -27.46595099999996, 0],
              [153.01628600000004, -27.465938999999935, 0],
              [153.01645000000008, -27.46596299999993, 0],
              [153.01660900000002, -27.466002999999944, 0],
              [153.01756000000012, -27.46624399999996, 0],
              [153.0179680000001, -27.466349999999977, 0],
              [153.0189230000001, -27.466594999999984, 0],
              [153.01902800000005, -27.466625999999962, 0],
              [153.01948100000004, -27.466758999999968, 0],
              [153.02014700000007, -27.466910999999982, 0],
              [153.02050600000007, -27.466988999999955, 0],
              [153.02088200000003, -27.467086999999935, 0],
              [153.02196800000002, -27.467521999999974, 0],
              [153.022329, -27.46767699999998, 0],
              [153.02255800000012, -27.467773999999963, 0],
              [153.0228750000001, -27.46789899999993, 0]
            ]
          }
        }
      });

      map.addLayer({
        id: "route",
        type: "line",
        source: "route",
        layout: {
          "line-join": "round",
          "line-cap": "round"
        },
        paint: {
          "line-color": "#FF4500",
          "line-width": 8
        }
      });

      map.addSource("drone", { type: "geojson", data: that.state.response });
      map.addLayer({
        id: "drone",
        type: "symbol",
        source: "drone",
        layout: {
          "icon-image": "bus-15"
        },
        paint: {
          // "icon-color": "#0000ff"
          // "fill-color": "#0000ff"
        }
      });
    });
  }

  render() {
    return (
      <div>
        <div ref={el => (this.mapContainer = el)} style={mapStyle} />
      </div>
    );
  }
}

export default Realtime;

//temp sydney
// type: "LineString",
// coordinates: [
//   [151.236197636045, -33.8793459155006],
//   [151.236270102223, -33.8790641186614],
//   [151.236618742602, -33.8791241886502],
//   [151.236698681636, -33.879211532399],
//   [151.236621667563, -33.8796196220385],
//   [151.236648133632, -33.8797178172816],
//   [151.236769872393, -33.8797766920859],
//   [151.237172434791, -33.879834903025],
//   [151.237313514598, -33.8798480624656],
//   [151.237550312095, -33.8798308950938],
//   [151.237524829558, -33.8795344526469],
//   [151.237428315457, -33.879330554293],
//   [151.237346594044, -33.8792072336254],
//   [151.237090107239, -33.8790448845777],
//   [151.235102992177, -33.8786177837016],
//   [151.234823608418, -33.878429188827],
//   [151.234458058943, -33.8780273262124],
//   [151.233884065767, -33.8775605593464],
//   [151.233884065767, -33.8775605593464],
//   [151.233636148704, -33.8773528589532],
//   [151.233336095153, -33.8771829912138],
//   [151.23322603561, -33.8771417302505],
//   [151.232417380868, -33.8769533233366],
//   [151.231601058918, -33.8768282428308],
//   [151.231871199296, -33.8766117255702],
//   [151.232023610356, -33.8764172776682],
//   [151.232128884072, -33.8761433637671],
//   [151.232146111307, -33.8758364401252],
//   [151.232256276855, -33.875661464913],
//   [151.232328646432, -33.8755959068357],
//   [151.232423916928, -33.8755565899681],
//   [151.232786100511, -33.8754540304707],
//   [151.233182073544, -33.8751611028235],
//   [151.233182073544, -33.8751611028235],
//   [151.233702102972, -33.874755787674],
//   [151.233897639382, -33.8745598534727],
//   [151.233897639382, -33.8745598534727],
//   [151.234742694368, -33.8737379093528],
//   [151.235502015787, -33.8727116883556],
//   [151.235502015787, -33.8727116883556],
//   [151.235663859671, -33.8724898825596],
//   [151.236137467334, -33.8713653790263],
//   [151.23617036014, -33.8711570228153],
//   [151.236170459708, -33.8709407861301],
//   [151.236170459708, -33.8709407861301],
//   [151.236167888594, -33.8706705830914],
//   [151.236100522098, -33.8706188445321],
//   [151.236097851411, -33.8705648781783],
//   [151.236149538916, -33.8705180497342],
//   [151.23623624495, -33.8705240737051],
//   [151.236287042087, -33.8704592564297],
//   [151.236226551843, -33.8701099604073],
//   [151.236311330533, -33.869422302329],
//   [151.236382356606, -33.8693297592817],
//   [151.236874441374, -33.8690154920678],
//   [151.236874441374, -33.8690154920678],
//   [151.237115313768, -33.8688630406959],
//   [151.237275714006, -33.8688304869364],
//   [151.238186332088, -33.8688982256865],
//   [151.238963999231, -33.8688984611144],
//   [151.238963999231, -33.8688984611144],
//   [151.239158527285, -33.8689007677915],
//   [151.239132601229, -33.868595331114],
//   [151.240144267234, -33.8687406606715],
//   [151.240243000452, -33.8689895292952],
//   [151.240243000452, -33.8689895292952],
//   [151.24031571419, -33.8691491976418],
//   [151.240007209198, -33.8698986265379],
//   [151.239718664147, -33.8701788623465],
//   [151.239538833774, -33.8704733704182],
//   [151.239358910698, -33.8709841143865],
//   [151.238477945907, -33.8708613054199],
//   [151.238477945907, -33.8708613054199],
//   [151.238216936153, -33.8708252494511],
//   [151.23787170157, -33.8712696091271],
//   [151.237806019509, -33.8714700854695],
//   [151.237790593106, -33.8718129859271],
//   [151.237972535973, -33.8728698638516],
//   [151.237972535973, -33.8728698638516],
//   [151.237986436315, -33.8729324529389],
//   [151.237897851805, -33.8731066892332],
//   [151.237701882902, -33.8732936345151],
//   [151.237114512814, -33.8736472267931],
//   [151.236607168945, -33.8738719243253],
//   [151.236257017795, -33.8742173426589],
//   [151.236257017795, -33.8742173426589],
//   [151.236178321304, -33.8743732179404],
//   [151.236256028961, -33.8744155904744],
//   [151.23628204715, -33.8745047916272],
//   [151.236210126888, -33.8745793461265],
//   [151.236135090201, -33.8745909398905],
//   [151.236075981308, -33.8751425681296],
//   [151.235957267189, -33.8753628893954],
//   [151.235729384465, -33.8755599405736],
//   [151.235486266048, -33.8756674187767],
//   [151.235486266048, -33.8756674187767],
//   [151.235159106188, -33.8758228386509],
//   [151.235060175114, -33.8760064391678],
//   [151.234842869044, -33.8766355913247],
//   [151.234788647741, -33.8772861579308],
//   [151.235067725938, -33.878123463379],
//   [151.235067725938, -33.878123463379],
//   [151.235119763061, -33.8783018661168],
//   [151.23510843409, -33.8785094797097],
//   [151.235262966221, -33.8785762367614],
//   [151.237607723329, -33.8790270532778],
//   [151.237599424811, -33.8795138633612],
//   [151.237636136784, -33.8798189286175],
//   [151.237313514598, -33.8798480624656],
//   [151.236769872393, -33.8797766920859],
//   [151.236423901052, -33.8797705889935],
//   [151.236216782909, -33.8797326737547],
//   [151.236363050989, -33.8791960631534]
// ]
